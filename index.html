<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>南めぐりんバス時刻表</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 100%;
            padding: 16px;
            box-sizing: border-box;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #333;
        }
        .date-time {
            font-size: 1.2rem;
        }
        .refresh-button {
            width: 100%;
            background-color: #fff;
            color: #333;
            border: 1px solid #333;
            padding: 10px;
            font-size: 1.1rem;
            text-align: center;
            margin: 10px 0;
            cursor: pointer;
        }
        .bus-stop-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .bus-direction {
            width: 48%;
            border: 1px solid #333;
            padding: 10px;
            box-sizing: border-box;
        }
        .bus-direction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .direction-name {
            font-size: 1.1rem;
            font-weight: bold;
        }
        .change-button {
            border: 1px solid #333;
            padding: 5px 10px;
            background-color: #fff;
            cursor: pointer;
        }
        .bus-times {
            margin-top: 10px;
        }
        .bus-stop-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .bus-time {
            margin-bottom: 5px;
        }
        .countdown {
            font-weight: bold;
        }
        .map-container {
            border: 1px solid #333;
            padding: 10px;
            margin-top: 10px;
        }
        .map-title {
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
        }
        .map-content {
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #333;
        }
        .bus-guide {
            text-align: center;
            margin: 10px 0;
            font-size: 1.1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="date-time" id="current-date">3月3日 月曜日</div>
            <div class="date-time" id="current-time">現在時刻：18:43</div>
        </div>

        <button class="refresh-button" id="refresh-button">更新</button>

        <div class="bus-stop-container">
            <div class="bus-direction">
                <div class="bus-direction-header">
                    <div class="direction-name">乗り場</div>
                    <button class="change-button" id="change-boarding">変更</button>
                </div>
                <div class="bus-times" id="boarding-times">
                    <div class="bus-stop-name">16番 バス停名</div>
                    <div class="bus-time">1本目：<span id="next-bus-boarding-1">--:--</span> <span class="countdown" id="countdown-boarding-1">あと -- 分</span></div>
                    <div class="bus-time">2本目：<span id="next-bus-boarding-2">--:--</span> <span class="countdown" id="countdown-boarding-2">あと -- 分</span></div>
                </div>
            </div>

            <div class="bus-direction">
                <div class="bus-direction-header">
                    <div class="direction-name">降り場</div>
                    <button class="change-button" id="change-alighting">変更</button>
                </div>
                <div class="bus-times" id="alighting-times">
                    <div class="bus-stop-name">16番 バス停名</div>
                    <div class="bus-time">1本目：<span id="next-bus-alighting-1">--:--</span> <span class="countdown" id="countdown-alighting-1">あと -- 分</span></div>
                    <div class="bus-time">2本目：<span id="next-bus-alighting-2">--:--</span> <span class="countdown" id="countdown-alighting-2">あと -- 分</span></div>
                </div>
            </div>
        </div>

        <div class="bus-guide">バス乗り場案内</div>

        <div class="map-container">
            <div class="map-title">地図</div>
            <div class="map-content">
                <!-- 地図コンテンツがここに入ります -->
                ここに地図が表示されます
            </div>
        </div>
    </div>

    <script>
        // 南めぐりんの時刻表データ（CSVから変換）
        const busData = {
            // バス停ID: { name: バス停名, weekday: [時刻リスト], weekend: [時刻リスト] }
            "1": {
                name: "浅草駅",
                weekday: ["08:30", "08:45", "09:00", "09:15", "09:30", "09:45", "10:00", "10:15", "10:30", "10:45", "11:00", "11:15", "11:30", "11:45", "12:00", "12:15", "12:30", "12:45", "13:00", "13:15", "13:30", "13:45", "14:00", "14:15", "14:30", "14:45", "15:00", "15:15", "15:30", "15:45", "16:00", "16:15", "16:30", "16:45"],
                weekend: ["09:30", "09:45", "10:00", "10:15", "10:30", "10:45", "11:00", "11:15", "11:30", "11:45", "12:00", "12:15", "12:30", "12:45", "13:00", "13:15", "13:30", "13:45", "14:00", "14:15", "14:30", "14:45", "15:00", "15:15", "15:30", "15:45", "16:00", "16:15", "16:30", "16:45"]
            },
            "2": {
                name: "雷門通り",
                weekday: ["08:32", "08:47", "09:02", "09:17", "09:32", "09:47", "10:02", "10:17", "10:32", "10:47", "11:02", "11:17", "11:32", "11:47", "12:02", "12:17", "12:32", "12:47", "13:02", "13:17", "13:32", "13:47", "14:02", "14:17", "14:32", "14:47", "15:02", "15:17", "15:32", "15:47", "16:02", "16:17", "16:32", "16:47"],
                weekend: ["09:32", "09:47", "10:02", "10:17", "10:32", "10:47", "11:02", "11:17", "11:32", "11:47", "12:02", "12:17", "12:32", "12:47", "13:02", "13:17", "13:32", "13:47", "14:02", "14:17", "14:32", "14:47", "15:02", "15:17", "15:32", "15:47", "16:02", "16:17", "16:32", "16:47"]
            },
            "3": {
                name: "浅草寺",
                weekday: ["08:35", "08:50", "09:05", "09:20", "09:35", "09:50", "10:05", "10:20", "10:35", "10:50", "11:05", "11:20", "11:35", "11:50", "12:05", "12:20", "12:35", "12:50", "13:05", "13:20", "13:35", "13:50", "14:05", "14:20", "14:35", "14:50", "15:05", "15:20", "15:35", "15:50", "16:05", "16:20", "16:35", "16:50"],
                weekend: ["09:35", "09:50", "10:05", "10:20", "10:35", "10:50", "11:05", "11:20", "11:35", "11:50", "12:05", "12:20", "12:35", "12:50", "13:05", "13:20", "13:35", "13:50", "14:05", "14:20", "14:35", "14:50", "15:05", "15:20", "15:35", "15:50", "16:05", "16:20", "16:35", "16:50"]
            },
            "4": {
                name: "浅草文化観光センター",
                weekday: ["08:38", "08:53", "09:08", "09:23", "09:38", "09:53", "10:08", "10:23", "10:38", "10:53", "11:08", "11:23", "11:38", "11:53", "12:08", "12:23", "12:38", "12:53", "13:08", "13:23", "13:38", "13:53", "14:08", "14:23", "14:38", "14:53", "15:08", "15:23", "15:38", "15:53", "16:08", "16:23", "16:38", "16:53"],
                weekend: ["09:38", "09:53", "10:08", "10:23", "10:38", "10:53", "11:08", "11:23", "11:38", "11:53", "12:08", "12:23", "12:38", "12:53", "13:08", "13:23", "13:38", "13:53", "14:08", "14:23", "14:38", "14:53", "15:08", "15:23", "15:38", "15:53", "16:08", "16:23", "16:38", "16:53"]
            },
            "5": {
                name: "新御徒町駅",
                weekday: ["08:45", "09:00", "09:15", "09:30", "09:45", "10:00", "10:15", "10:30", "10:45", "11:00", "11:15", "11:30", "11:45", "12:00", "12:15", "12:30", "12:45", "13:00", "13:15", "13:30", "13:45", "14:00", "14:15", "14:30", "14:45", "15:00", "15:15", "15:30", "15:45", "16:00", "16:15", "16:30", "16:45", "17:00"],
                weekend: ["09:45", "10:00", "10:15", "10:30", "10:45", "11:00", "11:15", "11:30", "11:45", "12:00", "12:15", "12:30", "12:45", "13:00", "13:15", "13:30", "13:45", "14:00", "14:15", "14:30", "14:45", "15:00", "15:15", "15:30", "15:45", "16:00", "16:15", "16:30", "16:45", "17:00"]
            }
        };

        // 現在選択されているバス停ID
        let currentBoardingStopId = "1";
        let currentAlightingStopId = "1";

        // 日付と時刻の更新
        function updateDateTime() {
            const now = new Date();
            const days = ['日', '月', '火', '水', '木', '金', '土'];
            
            // 日付の更新
            const dateElement = document.getElementById('current-date');
            dateElement.textContent = `${now.getMonth() + 1}月${now.getDate()}日 ${days[now.getDay()]}曜日`;
            
            // 時刻の更新
            const timeElement = document.getElementById('current-time');
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            timeElement.textContent = `現在時刻：${hours}:${minutes}`;
            
            return now;
        }

        // 時刻を分に変換する関数
        function timeToMinutes(timeString) {
            const [hours, minutes] = timeString.split(':').map(Number);
            return hours * 60 + minutes;
        }

        // 次の出発時刻を計算する関数
        function getNextDepartures(stopId, now) {
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            const isWeekend = now.getDay() === 0 || now.getDay() === 6;
            const timetable = isWeekend ? busData[stopId].weekend : busData[stopId].weekday;
            
            // 今日の残りの出発時刻をフィルタリング
            const upcomingDepartures = timetable.filter(time => {
                const departureMinutes = timeToMinutes(time);
                return departureMinutes >= currentMinutes;
            });
            
            if (upcomingDepartures.length === 0) {
                return {
                    departures: ["本日の運行は終了しました", "本日の運行は終了しました"],
                    countdowns: [null, null]
                };
            }
            
            // 次の2つの出発時刻を取得
            const nextDepartures = upcomingDepartures.slice(0, 2);
            
            // カウントダウンを計算
            const countdowns = nextDepartures.map(time => {
                const departureMinutes = timeToMinutes(time);
                return departureMinutes - currentMinutes;
            });
            
            // 足りない場合は埋める
            while (nextDepartures.length < 2) {
                nextDepartures.push("本日の運行は終了しました");
                countdowns.push(null);
            }
            
            return {
                departures: nextDepartures,
                countdowns: countdowns
            };
        }

        // バス停情報を更新する関数
        function updateBusStopInfo(now) {
            // 乗り場の更新
            const boardingStop = busData[currentBoardingStopId];
            document.querySelector('#boarding-times .bus-stop-name').textContent = `${currentBoardingStopId}番 ${boardingStop.name}`;
            
            const boardingDepartures = getNextDepartures(currentBoardingStopId, now);
            document.getElementById('next-bus-boarding-1').textContent = boardingDepartures.departures[0];
            document.getElementById('next-bus-boarding-2').textContent = boardingDepartures.departures[1];
            
            document.getElementById('countdown-boarding-1').textContent = 
                boardingDepartures.countdowns[0] !== null ? `あと${boardingDepartures.countdowns[0]}分` : '';
            document.getElementById('countdown-boarding-2').textContent = 
                boardingDepartures.countdowns[1] !== null ? `あと${boardingDepartures.countdowns[1]}分` : '';
            
            // 降り場の更新
            const alightingStop = busData[currentAlightingStopId];
            document.querySelector('#alighting-times .bus-stop-name').textContent = `${currentAlightingStopId}番 ${alightingStop.name}`;
            
            const alightingDepartures = getNextDepartures(currentAlightingStopId, now);
            document.getElementById('next-bus-alighting-1').textContent = alightingDepartures.departures[0];
            document.getElementById('next-bus-alighting-2').textContent = alightingDepartures.departures[1];
            
            document.getElementById('countdown-alighting-1').textContent = 
                alightingDepartures.countdowns[0] !== null ? `あと${alightingDepartures.countdowns[0]}分` : '';
            document.getElementById('countdown-alighting-2').textContent = 
                alightingDepartures.countdowns[1] !== null ? `あと${alightingDepartures.countdowns[1]}分` : '';
        }

        // バス停変更ダイアログを表示する関数
        function showBusStopDialog(type) {
            // 簡易的なダイアログを実装
            const stopId = prompt(`${type === 'boarding' ? '乗り場' : '降り場'}のバス停番号を入力してください (1-5):`);
            if (stopId && busData[stopId]) {
                if (type === 'boarding') {
                    currentBoardingStopId = stopId;
                } else {
                    currentAlightingStopId = stopId;
                }
                const now = updateDateTime();
                updateBusStopInfo(now);
            } else if (stopId) {
                alert('無効なバス停番号です。1から5の番号を入力してください。');
            }
        }

        // アプリ初期化
        function initApp() {
            // 日付と時刻の初期化
            const now = updateDateTime();
            updateBusStopInfo(now);
            
            // 定期的な更新（1分ごと）
            setInterval(() => {
                const now = updateDateTime();
                updateBusStopInfo(now);
            }, 60000);
            
            // 更新ボタンのイベントリスナー
            document.getElementById('refresh-button').addEventListener('click', () => {
                const now = updateDateTime();
                updateBusStopInfo(now);
            });
            
            // バス停変更ボタンのイベントリスナー
            document.getElementById('change-boarding').addEventListener('click', () => {
                showBusStopDialog('boarding');
            });
            
            document.getElementById('change-alighting').addEventListener('click', () => {
                showBusStopDialog('alighting');
            });
        }

        // DOMコンテンツが読み込まれたらアプリを初期化
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
